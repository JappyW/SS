<div class="container" *ngIf="(projects|filter:term) as result">
  <div class="row justify-content-center m-4 p-4">
    <div class="col-md-8 d-flex flex-column align-items-center">
      <button class="btn btn-primary shadow-none m-4" style="max-width: 40%" routerLink="/create-project"><i
          class="fa fa-plus orange-icon"></i> Create</button>
      <input type="text" class="form-control mt-4" aria-label="Default" aria-describedby="inputGroup-sizing-default"
        [(ngModel)]="term" placeholder="Search...">
    </div>
    <div *ngIf="result.length === 0" class="p-4 mt-4 card container text-center">Results have not been found</div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <div class="card mt-4" style="margin-bottom: 2.5em"
        *ngFor="let item of result |  paginate: { itemsPerPage: 5, currentPage: p }; let i = index">
        <div class="card-body row justify-content-around">
          <div class="col-md-3 d-flex flex-column justify-content-between">
            <img class="img-fluid d-block mx-auto" style="border-radius: 100%;max-height: 80%;max-width: 80%;"
              src="{{item.imgref}}" alt="Project">
            <h6 class="text-center pt-4 " style="color: #ff8c00;">{{item.owner}}</h6>

          </div>
          <div class="col-md-9">
            <div class="content mb-4 pb-3">
              <h5 class="card-title">{{item.name}}</h5>
              <h6 class="card-subtitle muted mb-1">{{item.description}}</h6>
              <span *ngIf="item.users.length">Users:</span>

              <div *ngFor="let innerItem of item.users|slice:0:showMoreUsers let i=index">
                <div class="row justify-content-between pb-2 ml-0 mr-0">
                  <span [ngClass]='{normal:innerItem.value, dimmed: !innerItem.value}'>{{innerItem.email}} -
                    <span>{{innerItem.role|slice:0:showMoreRole}}</span>
                  </span>
                  <a href="#" class="card-link btn btn-danger btn-sm" style="font-size: 0.7rem;"
                    data-target="#delete-the-user-modal" data-toggle="modal" data-backdrop="static"
                    data-keyboard="false" [hidden]='!checkOwner(item)  && !checkRole(item.users, "Developer")'
                    (click)='deleteUser(item,innerItem)'><i class="fa fa-xs fa-user-times red-icon"></i></a>

                </div>
                <button class="btn btn-info btn-sm" style="font-size: 10px;"
                  *ngIf="i == 2 && showMoreUsers == 3 && item.users.length > 3"
                  (click)="showMoreUsers = item.users.length; showMoreRole = 10; showMorePressed=!showMorePressed">More</button>
                <button class="btn btn-info btn-sm" style="font-size: 10px;"
                  *ngIf="showMorePressed && i == item.users.length-1 && item.users.length > 3"
                  (click)="showMoreUsers = 3; showMoreRole = 1; showMorePressed=!showMorePressed">Less</button>
              </div>


            </div>
            <div class="row" style="position: absolute; bottom:0; right:30px;">
              <a href="#" class="card-link btn btn-success" data-toggle="modal" data-target="#add-the-user-modal"
                data-backdrop="static" data-keyboard="false"
                [hidden]='!checkOwner(item) && !checkRole(item.users, "Developer")' (click)="loadUsers(item)"><i
                  class="fa fa-user-plus green-icon"></i></a>
              <a href="#" class="card-link btn btn-warning" data-toggle="modal" data-target="#update-the-record-modal"
                [hidden]='!checkOwner(item) && !checkRole(item.users, "Maintainer") && !checkRole(item.users, "Developer")'
                (click)="edit(item)"><i class="fa fa-edit yellow-icon"></i></a>
              <a href="#" class="card-link btn btn-danger" data-toggle="modal" data-target="#delete-the-record-modal"
                [hidden]='!checkOwner(item)' (click)=prepareToDelete(item)><i class="fa fa-trash red-icon"></i></a>
            </div>
          </div>
        </div>

        <div class="modal fade" id="delete-the-record-modal" tabindex="-1" role="dialog"
          aria-labelledby="delete-the-record-modal-label" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="delete-the-record-modal-label">Delete</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                Delete the project?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal" (click)="delete()">Delete</button>
              </div>
            </div>
          </div>
        </div>
        <!--delete-modal-->

        <div class="modal fade" id="delete-the-user-modal" tabindex="-1" role="dialog"
          aria-labelledby="delete-the-user-modal-label" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="delete-the-user-modal-label">Delete</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                Delete the user?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal"
                  (click)=updateUser(item)>Delete</button>
              </div>
            </div>
          </div>
        </div>
        <!--delete-user-modal-->

        <div class="modal mt-3 m-0" id="add-the-user-modal" tabindex="-1" role="dialog"
          aria-labelledby="add-the-user-modal-label" aria-hidden="true">
          <div class="modal-dialog mt-0" style="max-width: 80%;max-height: 80%" role="document">
            <div class="modal-content">
              <div class="modal-header p-3">
                <h5 class="modal-title" id="add-the-user-modal-label">Add the user</h5>
                <button type="button" class="close" aria-label="Close" (click)="finishTheUpdateWithoutSave()"
                  data-dismiss="modal">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="container">
                <div class="row d-flex text-center justify-content-between align-users-between p-4">
                  <div class="col-md-12 justify-content-center">
                    <label id="example-radio-group-label" class="d-block text-center"
                      style="font-size: 25px; text-transform: uppercase">Pick the
                      role</label>
                    <mat-radio-group aria-labelledby="example-radio-group-label"
                      class="example-radio-group text-center d-block" [(ngModel)]="userRolesRadio">
                      <mat-radio-button class="example-radio-button p-2 m-2" *ngFor="let role of roles" [value]="role">
                        {{role}}
                      </mat-radio-button>
                    </mat-radio-group>
                  </div>
                  <div class="card col-md-3 col-sm-3 m-4"
                    *ngFor="let user of users |filter:term |  paginate: { itemsPerPage: 6, currentPage: s }">
                    <div class="card-body row d-flex flex-column justify-content-end text-center p-3">
                      <h5 class="card-title">{{(user.displayName) ? user.displayName : ""}}</h5>
                      <img src="{{user.photoURL}}" alt="User"
                        style="border-radius: 100%; max-width: 100px; max-height: 100px;"
                        class="img-fluid d-block mx-auto p-2">
                      <h5 class="card-title">{{user.email}}</h5>
                      <span class="card-text text-left" [hidden]="!user.userDescription">About User:
                        {{user.userDescription? user.userDescription : ""}}</span>
                      <div class="row justify-content-start p-2 mb-1">
                        <span class="btn btn-primary btn-sm m-1" *ngFor="let tags of user.userTags">{{tags.text}}</span>
                      </div>

                      <button style="max-width: 40%" class="btn btn-success shadow-none mr-auto ml-auto"
                        (click)="addUserToProject(user,userRolesRadio)" [disabled]='!userRolesRadio'><i
                          class="fa fa-user-plus green-icon"></i> Add</button>
                    </div>
                  </div>
                </div>
                <pagination-controls autoHide="true" responsive="true" class="text-center" (pageChange)="s = $event">
                </pagination-controls>

              </div>
              <div class="modal-footer container justify-content-center ml-auto mr-auto">
                <div class="col-md-12 justify-content-center text-center pb-3">
                  <button type="button" class="btn btn-success shadow-none" data-dismiss="modal"
                    (click)="finishTheUpdate()"><i class="fa fa-save green-icon"></i> Save</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--add-user-modal-->
        <div class="modal fade" id="update-the-record-modal" tabindex="-1" role="dialog"
          aria-labelledby="update-the-record-modal-label" aria-hidden="true">
          <div class="modal-dialog" style="width: 100%; height: 100%" role="document">
            <div class="modal-content">
              <form [formGroup]="ProjectNameForm" (ngSubmit)="update()" (keydown.enter)="$event.preventDefault()">
                <div class="modal-header">
                  <h5 class="modal-title" id="update-the-record-modal-label">Edit</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <div class="row">
                    <div class="col-md-12 mb-3 form-group">
                      <input type="file" class="form-control" formControlName="img" accept="image/*"
                        (change)="detectFiles($event)" [ngClass]="{ 'is-invalid': submitted && f.img.errors }"
                        placeholder="Image" required>
                      <div *ngIf="submitted && f.img.errors" class="invalid-feedback">
                        <div *ngIf="f.img.errors.required">Image is required</div>
                      </div>
                    </div>
                    <div class="col-md-12 mb-3 form-group">
                      <input type="text" class="form-control" formControlName="name" name="projectName"
                        [ngClass]="{ 'is-invalid': submitted && f.name.errors }" [(ngModel)]="projectName" required
                        placeholder="Name">
                      <div *ngIf="submitted && f.name.errors" class="invalid-feedback">
                        <div *ngIf="f.name.errors.required">Name is required</div>
                        <div *ngIf="f.name.errors.minlength">Name should have more than 4 symbols</div>
                        <div *ngIf="f.name.errors.maxlength">Name should have less than 50 symbols</div>
                      </div>
                    </div>
                    <div class="col-md-12 form-group">
                      <input type="text" class="form-control" formControlName="description" name="projectDescription"
                        [ngClass]="{ 'is-invalid': submitted && f.description.errors }" [(ngModel)]="projectDescription"
                        required placeholder="Description">
                      <div *ngIf="submitted && f.description.errors" class="invalid-feedback">
                        <div *ngIf="f.description.errors.required">Description is required</div>
                        <div *ngIf="f.description.errors.minlength">Description should have more than 4 symbols
                        </div>
                        <div *ngIf="f.description.errors.maxlength">Description should have less than 50 symbols
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="modal-footer form-group">
                  <button class="btn btn-secondary shadow-none" data-dismiss="modal"
                    #closeUpdateProjectModal>Cancel</button>
                  <button class="btn btn-primary shadow-none"
                    [disabled]="(!projectName || !projectDescription)">Update</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <!--update-modal-->

      </div>
    </div>
  </div>
  <br>
  <pagination-controls autoHide="true" responsive="true" class="text-center" (pageChange)="p = $event">
  </pagination-controls>


</div>